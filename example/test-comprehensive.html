<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logger å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      margin: 20px;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      padding: 20px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
      text-align: center;
    }

    .test-section {
      padding: 15px;
      margin: 20px 0;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .test-section h3 {
      margin-top: 0;
      color: #666;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
    }

    button {
      width: 100%;
      padding: 8px 16px;
      margin: 5px;
      color: white;
      cursor: pointer;
      background: #1890ff;
      border: none;
      border-radius: 4px;
    }

    button:hover {
      background: #40a9ff;
    }

    .note {
      padding: 10px;
      margin: 10px 0;
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      border-radius: 4px;
    }

    .success {
      color: #52c41a;
      background: #f6ffed;
      border: 1px solid #b7eb8f;
    }

    .warning {
      color: #faad14;
      background: #fffbe6;
      border: 1px solid #ffe58f;
    }

    .error {
      color: #ff4d4f;
      background: #fff2f0;
      border: 1px solid #ffccc7;
    }

    .test-result {
      padding: 8px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 12px;
      border-radius: 4px;
    }

    .run-all {
      margin: 20px 0;
      font-size: 16px;
      font-weight: bold;
      background: #52c41a;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Logger å®Œæ•´åŠŸèƒ½æµ‹è¯•</h1>

    <div class="note success">
      <strong>âœ… æµ‹è¯•è¦†ç›–èŒƒå›´ï¼š</strong>
      <ul>
        <li>Logger æ ¸å¿ƒåŠŸèƒ½ï¼šåˆ›å»ºã€ç¼“å­˜ã€ä»£ç†</li>
        <li>WebConsoleAdapterï¼šæ‰€æœ‰é…ç½®é€‰é¡¹å’Œåˆ†æ”¯</li>
        <li>æ ·å¼ç³»ç»Ÿï¼šé¢œè‰²æå–ã€æ¸å˜æ”¯æŒã€æ‰€æœ‰æ ¼å¼</li>
        <li>AllowTypesï¼šæ•°ç»„ã€Setã€å‡½æ•°ä¸‰ç§æ¨¡å¼</li>
        <li>ç¯å¢ƒéªŒè¯ï¼šWebç¯å¢ƒæ£€æµ‹</li>
        <li>åµŒå¥—è°ƒç”¨ï¼šçŠ¶æ€æœºå¤„ç†ã€æ·±åº¦æ§åˆ¶ã€è¶…é™ä¸¢å¼ƒ</li>
        <li>è¾¹ç¼˜æƒ…å†µï¼šé”™è¯¯å¤„ç†ã€é»˜è®¤å€¼</li>
      </ul>
    </div>

    <button class="run-all" onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯• (æ¨è)</button>

    <div class="test-grid">
      <!-- Logger æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• -->
      <div class="test-section">
        <h3>1. Logger æ ¸å¿ƒåŠŸèƒ½</h3>
        <button onclick="testLoggerCore()">æµ‹è¯• Logger åˆ›å»ºå’Œç¼“å­˜</button>
        <p>æµ‹è¯• createLoggerã€å‡½æ•°ç¼“å­˜ã€Proxy ä»£ç†</p>
      </div>

      <!-- WebConsoleAdapter åŸºç¡€åŠŸèƒ½ -->
      <div class="test-section">
        <h3>2. WebConsoleAdapter åŸºç¡€</h3>
        <button onclick="testAdapterBasic()">æµ‹è¯•åŸºç¡€é€‚é…å™¨åŠŸèƒ½</button>
        <p>æµ‹è¯•é€‚é…å™¨åˆ›å»ºã€ç¯å¢ƒæ£€æµ‹ã€ç±»å‹è¿‡æ»¤</p>
      </div>

      <!-- Group åŠŸèƒ½æµ‹è¯• -->
      <div class="test-section">
        <h3>3. Group åˆ†ç»„åŠŸèƒ½</h3>
        <button onclick="testGroupFeatures()">æµ‹è¯•åˆ†ç»„åŠŸèƒ½</button>
        <p>æµ‹è¯• enable/disableã€collapsed/expanded</p>
      </div>

      <!-- ConsoleLevel æµ‹è¯• -->
      <div class="test-section">
        <h3>4. ConsoleLevel çº§åˆ«</h3>
        <button onclick="testConsoleLevels()">æµ‹è¯•æ§åˆ¶å°çº§åˆ«</button>
        <p>æµ‹è¯• debugã€infoã€logã€warn çº§åˆ«</p>
      </div>

      <!-- getSubTitle å’Œ getMessages -->
      <div class="test-section">
        <h3>5. æ¶ˆæ¯å¤„ç†å‡½æ•°</h3>
        <button onclick="testMessageHandlers()">æµ‹è¯•æ¶ˆæ¯å¤„ç†</button>
        <p>æµ‹è¯• getSubTitleã€getMessages å‡½æ•°</p>
      </div>

      <!-- AllowTypes ä¸‰ç§æ¨¡å¼ -->
      <div class="test-section">
        <h3>6. AllowTypes ç±»å‹è¿‡æ»¤</h3>
        <button onclick="testAllowTypes()">æµ‹è¯•ç±»å‹è¿‡æ»¤</button>
        <p>æµ‹è¯•æ•°ç»„ã€Setã€å‡½æ•°ä¸‰ç§æ¨¡å¼</p>
      </div>

      <!-- ç¯å¢ƒéªŒè¯ -->
      <div class="test-section">
        <h3>7. ç¯å¢ƒéªŒè¯</h3>
        <button onclick="testEnvironmentValidation()">æµ‹è¯•ç¯å¢ƒéªŒè¯</button>
        <p>æµ‹è¯• isEnvironmentValid å‡½æ•°</p>
      </div>

      <!-- æ ·å¼ç³»ç»Ÿ - é¢œè‰²æ ¼å¼ -->
      <div class="test-section">
        <h3>8. é¢œè‰²æ ¼å¼æ”¯æŒ</h3>
        <button onclick="testColorFormats()">æµ‹è¯•é¢œè‰²æ ¼å¼</button>
        <p>æµ‹è¯•åå…­è¿›åˆ¶ã€RGBã€HSL ç­‰æ ¼å¼</p>
      </div>

      <!-- æ ·å¼ç³»ç»Ÿ - æ¸å˜æ”¯æŒ -->
      <div class="test-section">
        <h3>9. æ¸å˜æ ·å¼æ”¯æŒ</h3>
        <button onclick="testGradientStyles()">æµ‹è¯•æ¸å˜æ ·å¼</button>
        <p>æµ‹è¯•æ¸å˜èƒŒæ™¯å’Œè¾¹æ¡†æå–</p>
      </div>

      <!-- CustomStyle å‡½æ•° -->
      <div class="test-section">
        <h3>10. CustomStyle è‡ªå®šä¹‰</h3>
        <button onclick="testCustomStyles()">æµ‹è¯•è‡ªå®šä¹‰æ ·å¼</button>
        <p>æµ‹è¯• customStyle å‡½æ•°å„ç§ç”¨æ³•</p>
      </div>

      <!-- Transform å’Œ Report -->
      <div class="test-section">
        <h3>11. Transform & Report</h3>
        <button onclick="testTransformReport()">æµ‹è¯•æ•°æ®è½¬æ¢</button>
        <p>æµ‹è¯• transform å’Œ report å‡½æ•°</p>
      </div>

      <!-- è¾¹ç¼˜æƒ…å†µæµ‹è¯• -->
      <div class="test-section">
        <h3>12. è¾¹ç¼˜æƒ…å†µå¤„ç†</h3>
        <button onclick="testEdgeCases()">æµ‹è¯•è¾¹ç¼˜æƒ…å†µ</button>
        <p>æµ‹è¯•é”™è¯¯å¤„ç†ã€é»˜è®¤å€¼ã€å¼‚å¸¸è¾“å…¥</p>
      </div>

      <!-- åµŒå¥—è°ƒç”¨æ·±åº¦æµ‹è¯• -->
      <div class="test-section">
        <h3>13. åµŒå¥—è°ƒç”¨æ·±åº¦æ§åˆ¶</h3>
        <button onclick="testNestingDepthControl()">æµ‹è¯•åµŒå¥—æ·±åº¦æ§åˆ¶</button>
        <p>æµ‹è¯•çŠ¶æ€æœºã€æ·±åº¦æ£€æµ‹ã€è¶…é™ä¸¢å¼ƒ</p>
      </div>

      <!-- æ€§èƒ½æµ‹è¯• -->
      <div class="test-section">
        <h3>14. æ€§èƒ½æµ‹è¯•</h3>
        <button onclick="testPerformance()">æµ‹è¯•æ€§èƒ½</button>
        <p>æµ‹è¯•å¤§é‡æ—¥å¿—è¾“å‡ºæ€§èƒ½</p>
      </div>

      <!-- å…¼å®¹æ€§æµ‹è¯• -->
      <div class="test-section">
        <h3>15. å…¼å®¹æ€§æµ‹è¯•</h3>
        <button onclick="testCompatibility()">æµ‹è¯•å…¼å®¹æ€§</button>
        <p>æµ‹è¯•å‘åå…¼å®¹æ€§å’Œé»˜è®¤è¡Œä¸º</p>
      </div>

      <!-- å¤æ‚åœºæ™¯æµ‹è¯• -->
      <div class="test-section">
        <h3>16. å¤æ‚åœºæ™¯</h3>
        <button onclick="testComplexScenarios()">æµ‹è¯•å¤æ‚åœºæ™¯</button>
        <p>æµ‹è¯•å¤šå®ä¾‹ã€åµŒå¥—è°ƒç”¨ç­‰å¤æ‚åœºæ™¯</p>
      </div>

      <!-- å†…å­˜æ³„æ¼æµ‹è¯• -->
      <div class="test-section">
        <h3>17. å†…å­˜ç®¡ç†</h3>
        <button onclick="testMemoryManagement()">æµ‹è¯•å†…å­˜ç®¡ç†</button>
        <p>æµ‹è¯•ç¼“å­˜ç®¡ç†å’Œå†…å­˜æ³„æ¼</p>
      </div>
    </div>

    <div class="note">
      <strong>è¯´æ˜ï¼š</strong>
      <ul>
        <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æµ‹è¯•ç»“æœ</li>
        <li>æ¯ä¸ªæµ‹è¯•éƒ½ä¼šè¾“å‡ºè¯¦ç»†çš„æµ‹è¯•ä¿¡æ¯å’Œç»“æœ</li>
        <li>å»ºè®®å…ˆç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"è·å¾—å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š</li>
        <li>å•ç‹¬çš„æµ‹è¯•å¯ä»¥ç”¨äºè°ƒè¯•ç‰¹å®šåŠŸèƒ½</li>
      </ul>
    </div>
  </div>

  <script type="module">
    import { webConsoleAdapter } from '../dist/adapters/web/index.js';
    import { createLogger } from '../dist/index.js';

    // æµ‹è¯•ç»“æœç»Ÿè®¡
    let testResults = {
      total: 0,
      passed: 0,
      failed: 0,
      errors: []
    };

    // æµ‹è¯•å·¥å…·å‡½æ•°
    function assert(condition, message) {
      testResults.total++;
      if (condition) {
        testResults.passed++;
        console.log(`âœ… ${message}`);
        return true;
      }
      testResults.failed++;
      testResults.errors.push(message);
      console.error(`âŒ ${message}`);
      return false;
    }

    function testSection(name, testFn) {
      console.group(`ğŸ§ª ${name}`);
      try {
        testFn();
      } catch (error) {
        testResults.failed++;
        testResults.errors.push(`${name}: ${error.message}`);
        console.error(`âŒ ${name} æµ‹è¯•å¼‚å¸¸:`, error);
      }
      console.groupEnd();
    }

    // 1. Logger æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
    function testLoggerCore() {
      console.clear();
      testSection('Logger æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•', () => {
        // æµ‹è¯• createLogger åŸºç¡€åŠŸèƒ½
        const logger1 = createLogger();
        assert(typeof logger1 === 'object', 'createLogger è¿”å›å¯¹è±¡');
        assert(typeof logger1.info === 'function', 'logger.info æ˜¯å‡½æ•°');
        assert(typeof logger1.debug === 'function', 'logger.debug æ˜¯å‡½æ•°');
        assert(typeof logger1.customType === 'function', 'logger.customType æ˜¯å‡½æ•°ï¼ˆåŠ¨æ€å±æ€§ï¼‰');

        // æµ‹è¯•å‡½æ•°ç¼“å­˜
        const loggerInfoFn1 = logger1.info;
        const loggerInfoFn2 = logger1.info;
        assert(loggerInfoFn1 === loggerInfoFn2, 'ç›¸åŒç±»å‹çš„æ—¥å¿—å‡½æ•°è¢«ç¼“å­˜');

        // æµ‹è¯•ä¸åŒå®ä¾‹çš„éš”ç¦»
        const logger2 = createLogger();
        assert(logger1.info !== logger2.info, 'ä¸åŒ logger å®ä¾‹çš„å‡½æ•°ä¸åŒ');

        // æµ‹è¯• Proxy ä»£ç†
        logger1.testProxy('Proxy ä»£ç†æµ‹è¯•');
        assert(typeof logger1.testProxy === 'function', 'Proxy ä»£ç†åŠ¨æ€åˆ›å»ºå‡½æ•°');
      });
    }

    // 2. WebConsoleAdapter åŸºç¡€åŠŸèƒ½æµ‹è¯•
    function testAdapterBasic() {
      console.clear();
      testSection('WebConsoleAdapter åŸºç¡€åŠŸèƒ½æµ‹è¯•', () => {
        // æµ‹è¯•é€‚é…å™¨åˆ›å»º
        const adapter = webConsoleAdapter();
        assert(typeof adapter === 'function', 'webConsoleAdapter è¿”å›å‡½æ•°');

        // æµ‹è¯•é€‚é…å™¨è¿”å›å€¼
        const outputFunc = adapter('info');
        assert(typeof outputFunc === 'function', 'adapter è¿”å›è¾“å‡ºå‡½æ•°');

        // æµ‹è¯•åŸºç¡€æ—¥å¿—è¾“å‡º
        const logger = createLogger({
          outputAdapters: [webConsoleAdapter()]
        });

        logger.info('åŸºç¡€é€‚é…å™¨æµ‹è¯•', { test: 'data' });
        assert(true, 'åŸºç¡€æ—¥å¿—è¾“å‡ºæ­£å¸¸');

        // æµ‹è¯•æ— é…ç½®çš„é»˜è®¤è¡Œä¸º
        const defaultLogger = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        defaultLogger.debug('é»˜è®¤é…ç½®æµ‹è¯•');
        assert(true, 'é»˜è®¤é…ç½®å·¥ä½œæ­£å¸¸');
      });
    }

    // 3. Group åˆ†ç»„åŠŸèƒ½æµ‹è¯•
    function testGroupFeatures() {
      console.clear();
      testSection('Group åˆ†ç»„åŠŸèƒ½æµ‹è¯•', () => {
        // æµ‹è¯• group enable = true, collapsed = false
        const logger1 = createLogger({
          outputAdapters: [webConsoleAdapter({
            group: { enable: true, collapsed: false }
          })]
        });
        logger1.info('åˆ†ç»„å±•å¼€æµ‹è¯•');
        assert(true, 'group enable=true, collapsed=false æµ‹è¯•');

        // æµ‹è¯• group enable = true, collapsed = true
        const logger2 = createLogger({
          outputAdapters: [webConsoleAdapter({
            group: { enable: true, collapsed: true }
          })]
        });
        logger2.info('åˆ†ç»„æŠ˜å æµ‹è¯•');
        assert(true, 'group enable=true, collapsed=true æµ‹è¯•');

        // æµ‹è¯• group enable = false
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({
            group: { enable: false }
          })]
        });
        logger3.info('æ— åˆ†ç»„æµ‹è¯•');
        assert(true, 'group enable=false æµ‹è¯•');

        // æµ‹è¯•é»˜è®¤ group é…ç½®
        const logger4 = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        logger4.info('é»˜è®¤åˆ†ç»„é…ç½®æµ‹è¯•');
        assert(true, 'é»˜è®¤ group é…ç½®æµ‹è¯•');
      });
    }

    // 4. ConsoleLevel çº§åˆ«æµ‹è¯•
    function testConsoleLevels() {
      console.clear();
      testSection('ConsoleLevel çº§åˆ«æµ‹è¯•', () => {
        const levels = ['debug', 'info', 'log', 'warn'];

        levels.forEach(level => {
          const logger = createLogger({
            outputAdapters: [webConsoleAdapter({
              consoleLevel: level,
              group: { enable: false }
            })]
          });

          logger.test(`${level} çº§åˆ«æµ‹è¯•`);
          assert(true, `consoleLevel: ${level} æµ‹è¯•`);
        });

        // æµ‹è¯•é»˜è®¤çº§åˆ«
        const defaultLogger = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        defaultLogger.test('é»˜è®¤çº§åˆ«æµ‹è¯•');
        assert(true, 'é»˜è®¤ consoleLevel æµ‹è¯•');
      });
    }

    // 5. æ¶ˆæ¯å¤„ç†å‡½æ•°æµ‹è¯•
    function testMessageHandlers() {
      console.clear();
      testSection('æ¶ˆæ¯å¤„ç†å‡½æ•°æµ‹è¯•', () => {
        // æµ‹è¯• getSubTitle
        const logger1 = createLogger({
          outputAdapters: [webConsoleAdapter({
            getSubTitle: (info) => `[${info.type.toUpperCase()}]`,
            group: { enable: false }
          })]
        });
        logger1.info('getSubTitle æµ‹è¯•');
        assert(true, 'getSubTitle å‡½æ•°æµ‹è¯•');

        // æµ‹è¯• getMessages
        const logger2 = createLogger({
          outputAdapters: [webConsoleAdapter({
            getMessages: (info) => ['è‡ªå®šä¹‰æ¶ˆæ¯', ...info.messages],
            group: { enable: false }
          })]
        });
        logger2.info('getMessages æµ‹è¯•');
        assert(true, 'getMessages å‡½æ•°æµ‹è¯•');

        // æµ‹è¯• getMessages è¿”å› null
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({
            getMessages: () => null,
            group: { enable: false }
          })]
        });
        logger3.info('getMessages null æµ‹è¯•');
        assert(true, 'getMessages è¿”å› null æµ‹è¯•');

        // æµ‹è¯•é»˜è®¤å¤„ç†å‡½æ•°
        const logger4 = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        logger4.info('é»˜è®¤å¤„ç†å‡½æ•°æµ‹è¯•');
        assert(true, 'é»˜è®¤æ¶ˆæ¯å¤„ç†å‡½æ•°æµ‹è¯•');
      });
    }

    // 6. AllowTypes ç±»å‹è¿‡æ»¤æµ‹è¯•
    function testAllowTypes() {
      console.clear();
      testSection('AllowTypes ç±»å‹è¿‡æ»¤æµ‹è¯•', () => {
        // æµ‹è¯•æ•°ç»„æ¨¡å¼ï¼ˆæ‰©å±•æ¨¡å¼ï¼‰
        const logger1 = createLogger({
          outputAdapters: [webConsoleAdapter({
            allowTypes: ['custom', 'special'],
            group: { enable: false }
          })]
        });
        logger1.info('æ•°ç»„æ¨¡å¼ - info åº”è¯¥æ˜¾ç¤º');
        logger1.custom('æ•°ç»„æ¨¡å¼ - custom åº”è¯¥æ˜¾ç¤º');
        logger1.blocked('æ•°ç»„æ¨¡å¼ - blocked ä¸åº”è¯¥æ˜¾ç¤º');
        assert(true, 'allowTypes æ•°ç»„æ¨¡å¼æµ‹è¯•');

        // æµ‹è¯• Set æ¨¡å¼ï¼ˆå®Œå…¨æ›¿æ¢æ¨¡å¼ï¼‰
        const logger2 = createLogger({
          outputAdapters: [webConsoleAdapter({
            allowTypes: new Set(['info', 'custom']),
            group: { enable: false }
          })]
        });
        logger2.info('Set æ¨¡å¼ - info åº”è¯¥æ˜¾ç¤º');
        logger2.custom('Set æ¨¡å¼ - custom åº”è¯¥æ˜¾ç¤º');
        logger2.debug('Set æ¨¡å¼ - debug ä¸åº”è¯¥æ˜¾ç¤º');
        assert(true, 'allowTypes Set æ¨¡å¼æµ‹è¯•');

        // æµ‹è¯•å‡½æ•°æ¨¡å¼ï¼ˆå®Œå…¨æ›¿æ¢æ¨¡å¼ï¼‰
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({
            allowTypes: (type) => type.startsWith('test'),
            group: { enable: false }
          })]
        });
        logger3.testInfo('å‡½æ•°æ¨¡å¼ - testInfo åº”è¯¥æ˜¾ç¤º');
        logger3.testDebug('å‡½æ•°æ¨¡å¼ - testDebug åº”è¯¥æ˜¾ç¤º');
        logger3.info('å‡½æ•°æ¨¡å¼ - info ä¸åº”è¯¥æ˜¾ç¤º');
        assert(true, 'allowTypes å‡½æ•°æ¨¡å¼æµ‹è¯•');

        // æµ‹è¯•é»˜è®¤ allowTypes
        const logger4 = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        logger4.debug('é»˜è®¤ allowTypes - debug åº”è¯¥æ˜¾ç¤º');
        logger4.info('é»˜è®¤ allowTypes - info åº”è¯¥æ˜¾ç¤º');
        logger4.warn('é»˜è®¤ allowTypes - warn åº”è¯¥æ˜¾ç¤º');
        logger4.error('é»˜è®¤ allowTypes - error åº”è¯¥æ˜¾ç¤º');
        assert(true, 'é»˜è®¤ allowTypes æµ‹è¯•');
      });
    }

    // 7. ç¯å¢ƒéªŒè¯æµ‹è¯•
    function testEnvironmentValidation() {
      console.clear();
      testSection('ç¯å¢ƒéªŒè¯æµ‹è¯•', () => {
        // æµ‹è¯•è‡ªå®šä¹‰ç¯å¢ƒéªŒè¯ - è¿”å› true
        const logger1 = createLogger({
          outputAdapters: [webConsoleAdapter({
            isEnvironmentValid: () => true,
            group: { enable: false }
          })]
        });
        logger1.info('ç¯å¢ƒéªŒè¯ true - åº”è¯¥æ˜¾ç¤º');
        assert(true, 'isEnvironmentValid è¿”å› true æµ‹è¯•');

        // æµ‹è¯•è‡ªå®šä¹‰ç¯å¢ƒéªŒè¯ - è¿”å› false
        const logger2 = createLogger({
          outputAdapters: [webConsoleAdapter({
            isEnvironmentValid: () => false,
            group: { enable: false }
          })]
        });
        logger2.info('ç¯å¢ƒéªŒè¯ false - ä¸åº”è¯¥æ˜¾ç¤º');
        assert(true, 'isEnvironmentValid è¿”å› false æµ‹è¯•');

        // æµ‹è¯•é»˜è®¤ç¯å¢ƒéªŒè¯ï¼ˆWeb ç¯å¢ƒï¼‰
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        logger3.info('é»˜è®¤ç¯å¢ƒéªŒè¯ - åº”è¯¥æ˜¾ç¤º');
        assert(true, 'é»˜è®¤ç¯å¢ƒéªŒè¯æµ‹è¯•');
      });
    }

    // 8. é¢œè‰²æ ¼å¼æ”¯æŒæµ‹è¯•
    function testColorFormats() {
      console.clear();
      testSection('é¢œè‰²æ ¼å¼æ”¯æŒæµ‹è¯•', () => {
        const colorTests = [
          { name: '3ä½åå…­è¿›åˆ¶', color: '#f00' },
          { name: '6ä½åå…­è¿›åˆ¶', color: '#ff0000' },
          { name: '4ä½åå…­è¿›åˆ¶', color: '#f00f' },
          { name: '8ä½åå…­è¿›åˆ¶', color: '#ff0000ff' },
          { name: 'RGB', color: 'rgb(255, 0, 0)' },
          { name: 'RGBA', color: 'rgba(255, 0, 0, 0.8)' },
          { name: 'HSL', color: 'hsl(0, 100%, 50%)' },
          { name: 'HSLA', color: 'hsla(0, 100%, 50%, 0.8)' }
        ];

        colorTests.forEach(({ name, color }) => {
          const logger = createLogger({
            outputAdapters: [webConsoleAdapter({
              customStyle: ({ theme, baseStyle }) => {
                return {
                  theme: { ...theme, primary: color },
                  baseStyle
                };
              },
              group: { enable: false }
            })]
          });

          logger.info(`${name} é¢œè‰²æµ‹è¯•`, `é¢œè‰²: ${color}`);
          assert(true, `${name} é¢œè‰²æ ¼å¼æµ‹è¯•`);
        });
      });
    }

    // 9. æ¸å˜æ ·å¼æ”¯æŒæµ‹è¯•
    function testGradientStyles() {
      console.clear();
      testSection('æ¸å˜æ ·å¼æ”¯æŒæµ‹è¯•', () => {
        const gradientTests = [
          {
            name: 'åå…­è¿›åˆ¶æ¸å˜',
            gradient: 'linear-gradient(45deg, #ff0000 0%, #00ff00 100%)'
          },
          {
            name: 'RGB æ¸å˜',
            gradient: 'linear-gradient(45deg, rgb(255, 0, 0) 0%, rgb(0, 255, 0) 100%)'
          },
          {
            name: 'RGBA æ¸å˜',
            gradient: 'linear-gradient(45deg, rgba(255, 0, 0, 0.8) 0%, rgba(0, 255, 0, 0.6) 100%)'
          },
          {
            name: 'HSL æ¸å˜',
            gradient: 'linear-gradient(45deg, hsl(0, 100%, 50%) 0%, hsl(120, 100%, 50%) 100%)'
          },
          {
            name: 'æ··åˆæ ¼å¼æ¸å˜',
            gradient: 'linear-gradient(45deg, #ff0000 0%, rgb(0, 255, 0) 50%, hsl(240, 100%, 50%) 100%)'
          },
          {
            name: 'å¾„å‘æ¸å˜',
            gradient: 'radial-gradient(circle, #ff0000 0%, #00ff00 100%)'
          }
        ];

        gradientTests.forEach(({ name, gradient }) => {
          const logger = createLogger({
            outputAdapters: [webConsoleAdapter({
              customStyle: ({ theme, baseStyle }) => {
                return {
                  theme: { ...theme, primary: gradient },
                  baseStyle
                };
              },
              group: { enable: false }
            })]
          });

          logger.info(`${name} æµ‹è¯•`, `æ¸å˜: ${gradient}`);
          assert(true, `${name} æ¸å˜æ ·å¼æµ‹è¯•`);
        });
      });
    }

    // 10. CustomStyle è‡ªå®šä¹‰æ ·å¼æµ‹è¯•
    function testCustomStyles() {
      console.clear();
      testSection('CustomStyle è‡ªå®šä¹‰æ ·å¼æµ‹è¯•', () => {
        // æµ‹è¯•ä¿®æ”¹ä¸»é¢˜
        const logger1 = createLogger({
          outputAdapters: [webConsoleAdapter({
            customStyle: ({ theme, baseStyle }) => {
              return {
                theme: { ...theme, primary: '#722ed1', tagColor: '#fff' },
                baseStyle
              };
            },
            group: { enable: false }
          })]
        });
        logger1.info('è‡ªå®šä¹‰ä¸»é¢˜æµ‹è¯•');
        assert(true, 'customStyle ä¿®æ”¹ä¸»é¢˜æµ‹è¯•');

        // æµ‹è¯•ä¿®æ”¹åŸºç¡€æ ·å¼
        const logger2 = createLogger({
          outputAdapters: [webConsoleAdapter({
            customStyle: ({ theme, baseStyle }) => {
              return {
                theme,
                baseStyle: { ...baseStyle, fontSize: '14px', borderRadiusSize: '10px' }
              };
            },
            group: { enable: false }
          })]
        });
        logger2.info('è‡ªå®šä¹‰åŸºç¡€æ ·å¼æµ‹è¯•');
        assert(true, 'customStyle ä¿®æ”¹åŸºç¡€æ ·å¼æµ‹è¯•');

        // æµ‹è¯•æ ¹æ®ç±»å‹åŠ¨æ€æ ·å¼
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({
            customStyle: ({ type, theme, baseStyle }) => {
              const colors = { info: '#1890ff', warn: '#faad14', error: '#ff4d4f' };
              return {
                theme: { ...theme, primary: colors[type] || theme.primary },
                baseStyle
              };
            },
            group: { enable: false }
          })]
        });
        logger3.info('åŠ¨æ€æ ·å¼ info');
        logger3.warn('åŠ¨æ€æ ·å¼ warn');
        logger3.error('åŠ¨æ€æ ·å¼ error');
        assert(true, 'customStyle åŠ¨æ€æ ·å¼æµ‹è¯•');

        // æµ‹è¯•é»˜è®¤ customStyle
        const logger4 = createLogger({
          outputAdapters: [webConsoleAdapter({})]
        });
        logger4.info('é»˜è®¤ customStyle æµ‹è¯•');
        assert(true, 'é»˜è®¤ customStyle æµ‹è¯•');
      });
    }

    // 11. Transform å’Œ Report æµ‹è¯•
    function testTransformReport() {
      console.clear();
      testSection('Transform & Report æµ‹è¯•', () => {
        let transformCalled = false;
        let reportCalled = false;
        let transformData = null;
        let reportData = null;

        const logger = createLogger({
          transform: ({ type, messages, isNestingCall }) => {
            transformCalled = true;
            transformData = { type, messages, isNestingCall, timestamp: Date.now() };
            return transformData;
          },
          report: ({ type, messages, isNestingCall, data }) => {
            reportCalled = true;
            reportData = { type, messages, isNestingCall, data };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger.info('Transform Report æµ‹è¯•', { test: 'data' });

        assert(transformCalled, 'transform å‡½æ•°è¢«è°ƒç”¨');
        assert(reportCalled, 'report å‡½æ•°è¢«è°ƒç”¨');
        assert(transformData !== null, 'transform è¿”å›æ•°æ®');
        assert(reportData !== null, 'report æ¥æ”¶æ•°æ®');
        assert(reportData.data === transformData, 'transform å’Œ report æ•°æ®ä¸€è‡´');
        assert(transformData.isNestingCall === false, 'isNestingCall æ ‡è¯†æ­£ç¡®');
      });
    }

    // 12. è¾¹ç¼˜æƒ…å†µå¤„ç†æµ‹è¯•
    function testEdgeCases() {
      console.clear();
      testSection('è¾¹ç¼˜æƒ…å†µå¤„ç†æµ‹è¯•', () => {
        // æµ‹è¯•ç©ºæ¸å˜
        const logger1 = createLogger({
          outputAdapters: [webConsoleAdapter({
            customStyle: ({ theme, baseStyle }) => {
              return {
                theme: { ...theme, primary: 'linear-gradient(45deg)' },
                baseStyle
              };
            },
            group: { enable: false }
          })]
        });
        logger1.info('ç©ºæ¸å˜æµ‹è¯•');
        assert(true, 'ç©ºæ¸å˜è¾¹ç¼˜æƒ…å†µæµ‹è¯•');

        // æµ‹è¯•æ— æ•ˆé¢œè‰²
        const logger2 = createLogger({
          outputAdapters: [webConsoleAdapter({
            customStyle: ({ theme, baseStyle }) => {
              return {
                theme: { ...theme, primary: 'linear-gradient(45deg, invalidcolor 0%, badcolor 100%)' },
                baseStyle
              };
            },
            group: { enable: false }
          })]
        });
        logger2.info('æ— æ•ˆé¢œè‰²æµ‹è¯•');
        assert(true, 'æ— æ•ˆé¢œè‰²è¾¹ç¼˜æƒ…å†µæµ‹è¯•');

        // æµ‹è¯•ç©ºæ¶ˆæ¯
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });
        logger3.info();
        logger3.info('');
        logger3.info(null);
        logger3.info(undefined);
        assert(true, 'ç©ºæ¶ˆæ¯è¾¹ç¼˜æƒ…å†µæµ‹è¯•');

        // æµ‹è¯•å¼‚å¸¸å¯¹è±¡
        const circularObject = { __a: 1 };
        circularObject.self = circularObject;

        const logger4 = createLogger({
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });
        logger4.info('å¾ªç¯å¼•ç”¨å¯¹è±¡', circularObject);
        assert(true, 'å¾ªç¯å¼•ç”¨å¯¹è±¡è¾¹ç¼˜æƒ…å†µæµ‹è¯•');
      });
    }

    // 13. åµŒå¥—è°ƒç”¨æ·±åº¦æ§åˆ¶æµ‹è¯•
    function testNestingDepthControl() {
      console.clear();
      testSection('åµŒå¥—è°ƒç”¨æ·±åº¦æ§åˆ¶æµ‹è¯•', () => {
        // æµ‹è¯•çœŸæ­£çš„é€’è¿›åµŒå¥—è°ƒç”¨ï¼ˆæ¯å±‚è°ƒç”¨è§¦å‘ä¸‹ä¸€å±‚ï¼‰
        const logger1 = createLogger({
          maxNestingDepth: 3,
          transform: ({ type, messages, isNestingCall }) => {
            // åˆ›å»ºçœŸæ­£çš„é€’è¿›åµŒå¥—ï¼šæ¯ä¸€å±‚è°ƒç”¨éƒ½ä¼šè§¦å‘ä¸‹ä¸€å±‚
            if (type === 'level1' && !isNestingCall) {
              logger1.level2('ç¬¬2å±‚åµŒå¥—è°ƒç”¨');
            } else if (type === 'level2' && isNestingCall) {
              logger1.level3('ç¬¬3å±‚åµŒå¥—è°ƒç”¨');
            } else if (type === 'level3' && isNestingCall) {
              logger1.level4('ç¬¬4å±‚åµŒå¥—è°ƒç”¨ - åº”è¯¥è¢«ä¸¢å¼ƒ');
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger1.level1('ç¬¬1å±‚è°ƒç”¨ï¼Œè§¦å‘é€’è¿›åµŒå¥—');
        assert(true, 'é€’è¿›åµŒå¥—è°ƒç”¨æµ‹è¯•ï¼ˆ3å±‚é™åˆ¶ï¼‰');

        // æµ‹è¯•è‡ªå®šä¹‰æ·±åº¦é™åˆ¶ï¼ˆ2å±‚ï¼‰
        const logger2 = createLogger({
          maxNestingDepth: 2,
          transform: ({ type, messages, isNestingCall }) => {
            if (type === 'start' && !isNestingCall) {
              logger2.nested1('ç¬¬1å±‚åµŒå¥—');
            } else if (type === 'nested1' && isNestingCall) {
              logger2.nested2('ç¬¬2å±‚åµŒå¥—');
            } else if (type === 'nested2' && isNestingCall) {
              logger2.nested3('ç¬¬3å±‚åµŒå¥— - åº”è¯¥è¢«ä¸¢å¼ƒ');
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger2.start('è§¦å‘2å±‚æ·±åº¦é™åˆ¶æµ‹è¯•');
        assert(true, 'è‡ªå®šä¹‰æ·±åº¦é™åˆ¶ï¼ˆ2å±‚ï¼‰æµ‹è¯•');

        // æµ‹è¯•åŒä¸€å±‚å¤šä¸ªè°ƒç”¨ï¼ˆè¿™äº›è°ƒç”¨å±äºåŒä¸€åµŒå¥—å±‚çº§ï¼‰
        const logger3 = createLogger({
          transform: ({ type, messages, isNestingCall }) => {
            if (type === 'trigger' && !isNestingCall) {
              // è¿™äº›è°ƒç”¨éƒ½å±äºç¬¬1å±‚åµŒå¥—
              logger3.same1('åŒå±‚è°ƒç”¨1');
              logger3.same2('åŒå±‚è°ƒç”¨2');
              logger3.same3('åŒå±‚è°ƒç”¨3');
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger3.trigger('è§¦å‘åŒå±‚å¤šä¸ªè°ƒç”¨æµ‹è¯•');
        assert(true, 'åŒå±‚å¤šä¸ªè°ƒç”¨æµ‹è¯•');

        // æµ‹è¯•åµŒå¥—è°ƒç”¨ä¸­çš„ isNestingCall æ ‡è¯†
        let nestingCallDetected = false;
        const logger4 = createLogger({
          transform: ({ type, messages, isNestingCall }) => {
            if (type === 'trigger' && !isNestingCall) {
              logger4.nested('åµŒå¥—è°ƒç”¨');
            }
            if (type === 'nested' && isNestingCall) {
              nestingCallDetected = true;
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger4.trigger('è§¦å‘ isNestingCall æµ‹è¯•');
        assert(nestingCallDetected, 'isNestingCall æ ‡è¯†æ­£ç¡®æ£€æµ‹');

        // æµ‹è¯•çŠ¶æ€æœºæ­£ç¡®é‡ç½®
        const logger5 = createLogger({
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger5.info('ç¬¬ä¸€æ¬¡è°ƒç”¨');
        logger5.info('ç¬¬äºŒæ¬¡è°ƒç”¨ - çŠ¶æ€åº”è¯¥å·²é‡ç½®');
        assert(true, 'çŠ¶æ€æœºæ­£ç¡®é‡ç½®æµ‹è¯•');

        // æµ‹è¯•å¤æ‚çš„é€’è¿›åµŒå¥—åœºæ™¯
        const depthTracker = [];
        const logger6 = createLogger({
          maxNestingDepth: 3, // å…è®¸1ã€2ã€3å±‚åµŒå¥—ï¼Œä¸»è°ƒç”¨ä¸è®¡å…¥
          transform: ({ type, messages, isNestingCall }) => {
            // è®°å½•è°ƒç”¨æ·±åº¦
            if (type.startsWith('depth')) {
              const depth = isNestingCall ? 'nested' : 'main';
              depthTracker.push(`${type}:${depth}`);

              // åˆ›å»ºé€’è¿›åµŒå¥—
              if (type === 'depth1' && !isNestingCall) {
                // ä¸»è°ƒç”¨è§¦å‘ç¬¬1å±‚åµŒå¥—
                logger6.depth2('è¿›å…¥ç¬¬1å±‚åµŒå¥—');
              } else if (type === 'depth2' && isNestingCall) {
                // ç¬¬1å±‚åµŒå¥—è§¦å‘ç¬¬2å±‚åµŒå¥—
                logger6.depth3('è¿›å…¥ç¬¬2å±‚åµŒå¥—');
              } else if (type === 'depth3' && isNestingCall) {
                // ç¬¬2å±‚åµŒå¥—è§¦å‘ç¬¬3å±‚åµŒå¥—
                logger6.depth4('è¿›å…¥ç¬¬3å±‚åµŒå¥—');
              } else if (type === 'depth4' && isNestingCall) {
                // ç¬¬3å±‚åµŒå¥—è§¦å‘ç¬¬4å±‚åµŒå¥— - åº”è¯¥è¢«ä¸¢å¼ƒï¼ˆè¶…è¿‡maxNestingDepth=3ï¼‰
                logger6.depth5('è¿›å…¥ç¬¬4å±‚åµŒå¥— - åº”è¯¥è¢«ä¸¢å¼ƒ');
              }
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger6.depth1('å¼€å§‹å¤æ‚é€’è¿›åµŒå¥—æµ‹è¯•');

        // éªŒè¯æ·±åº¦è·Ÿè¸ªç»“æœ
        console.log('æ·±åº¦è·Ÿè¸ªç»“æœ:', depthTracker);
        console.log('åµŒå¥—æ·±åº¦è¯´æ˜: ä¸»è°ƒç”¨(depth1)ä¸è®¡å…¥åµŒå¥—æ·±åº¦ï¼Œdepth2=ç¬¬1å±‚åµŒå¥—ï¼Œdepth3=ç¬¬2å±‚åµŒå¥—ï¼Œdepth4=ç¬¬3å±‚åµŒå¥—');
        assert(depthTracker.includes('depth1:main'), 'ä¸»è°ƒç”¨æ­£ç¡®æ ‡è¯†ï¼ˆä¸è®¡å…¥åµŒå¥—æ·±åº¦ï¼‰');
        assert(depthTracker.includes('depth2:nested'), 'ç¬¬1å±‚åµŒå¥—æ­£ç¡®æ ‡è¯†');
        assert(depthTracker.includes('depth3:nested'), 'ç¬¬2å±‚åµŒå¥—æ­£ç¡®æ ‡è¯†');
        assert(depthTracker.includes('depth4:nested'), 'ç¬¬3å±‚åµŒå¥—æ­£ç¡®æ ‡è¯†');
        assert(!depthTracker.includes('depth5:nested'), 'ç¬¬4å±‚åµŒå¥—è¢«æ­£ç¡®ä¸¢å¼ƒï¼ˆè¶…è¿‡maxNestingDepth=3ï¼‰');
        assert(true, 'å¤æ‚é€’è¿›åµŒå¥—åœºæ™¯æµ‹è¯•');
      });
    }

    // 14. æ€§èƒ½æµ‹è¯•
    function testPerformance() {
      console.clear();
      testSection('æ€§èƒ½æµ‹è¯•', () => {
        const logger = createLogger({
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        // æµ‹è¯•å¤§é‡æ—¥å¿—è¾“å‡º
        const startTime = performance.now();
        for (let logIndex = 0; logIndex < 1000; logIndex++) {
          logger.info(`æ€§èƒ½æµ‹è¯• ${logIndex}`, { index: logIndex, data: 'test' });
        }
        const endTime = performance.now();
        const duration = endTime - startTime;

        console.log(`1000 æ¡æ—¥å¿—è¾“å‡ºè€—æ—¶: ${duration.toFixed(2)}ms`);
        assert(duration < 5000, `æ€§èƒ½æµ‹è¯•é€šè¿‡ (${duration.toFixed(2)}ms < 5000ms)`);

        // æµ‹è¯•å‡½æ•°ç¼“å­˜æ€§èƒ½
        const cacheStartTime = performance.now();
        for (let cacheIndex = 0; cacheIndex < 1000; cacheIndex++) {
          const cachedFunction = logger.info; // è®¿é—®ç¼“å­˜çš„å‡½æ•°
          void cachedFunction; // é¿å…æœªä½¿ç”¨å˜é‡è­¦å‘Š
        }
        const cacheEndTime = performance.now();
        const cacheDuration = cacheEndTime - cacheStartTime;

        console.log(`1000 æ¬¡å‡½æ•°ç¼“å­˜è®¿é—®è€—æ—¶: ${cacheDuration.toFixed(2)}ms`);
        assert(cacheDuration < 100, `ç¼“å­˜æ€§èƒ½æµ‹è¯•é€šè¿‡ (${cacheDuration.toFixed(2)}ms < 100ms)`);
      });
    }

    // 15. å…¼å®¹æ€§æµ‹è¯•
    function testCompatibility() {
      console.clear();
      testSection('å…¼å®¹æ€§æµ‹è¯•', () => {
        // æµ‹è¯•æ— é…ç½®åˆ›å»º
        const logger1 = createLogger();
        logger1.info('æ— é…ç½®å…¼å®¹æ€§æµ‹è¯•');
        assert(true, 'æ— é…ç½®åˆ›å»ºå…¼å®¹æ€§æµ‹è¯•');

        // æµ‹è¯•ç©ºé…ç½®
        const logger2 = createLogger({});
        logger2.info('ç©ºé…ç½®å…¼å®¹æ€§æµ‹è¯•');
        assert(true, 'ç©ºé…ç½®å…¼å®¹æ€§æµ‹è¯•');

        // æµ‹è¯•éƒ¨åˆ†é…ç½®
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter()]
        });
        logger3.info('éƒ¨åˆ†é…ç½®å…¼å®¹æ€§æµ‹è¯•');
        assert(true, 'éƒ¨åˆ†é…ç½®å…¼å®¹æ€§æµ‹è¯•');

        // æµ‹è¯•æ—§ç‰ˆæœ¬æ ·å¼ï¼ˆçº¯è‰²ï¼‰
        const logger4 = createLogger({
          outputAdapters: [webConsoleAdapter({
            customStyle: ({ theme, baseStyle }) => {
              return {
                theme: { ...theme, primary: '#ff0000' },
                baseStyle
              };
            }
          })]
        });
        logger4.info('æ—§ç‰ˆæœ¬çº¯è‰²æ ·å¼å…¼å®¹æ€§æµ‹è¯•');
        assert(true, 'æ—§ç‰ˆæœ¬æ ·å¼å…¼å®¹æ€§æµ‹è¯•');
      });
    }

    // 16. å¤æ‚åœºæ™¯æµ‹è¯•
    function testComplexScenarios() {
      console.clear();
      testSection('å¤æ‚åœºæ™¯æµ‹è¯•', () => {
        // æµ‹è¯•å¤šä¸ªé€‚é…å™¨
        const logger1 = createLogger({
          outputAdapters: [
            webConsoleAdapter({
              allowTypes: ['info'],
              customStyle: ({ theme, baseStyle }) => {
                return {
                  theme: { ...theme, primary: '#1890ff' },
                  baseStyle
                };
              }
            }),
            webConsoleAdapter({
              allowTypes: ['debug'],
              customStyle: ({ theme, baseStyle }) => {
                return {
                  theme: { ...theme, primary: '#722ed1' },
                  baseStyle
                };
              }
            })
          ]
        });
        logger1.info('å¤šé€‚é…å™¨ info æµ‹è¯•');
        logger1.debug('å¤šé€‚é…å™¨ debug æµ‹è¯•');
        assert(true, 'å¤šé€‚é…å™¨åœºæ™¯æµ‹è¯•');

        // æµ‹è¯•åµŒå¥—è°ƒç”¨ï¼ˆçŠ¶æ€æœºé˜²æº¢å‡ºæœºåˆ¶ï¼‰
        const logger2 = createLogger({
          transform: ({ type, messages, isNestingCall }) => {
            // åœ¨transformä¸­è°ƒç”¨loggerï¼Œæµ‹è¯•çŠ¶æ€æœºé˜²æº¢å‡ºæœºåˆ¶
            if (type === 'trigger' && !isNestingCall) {
              logger2.nested('åµŒå¥—è°ƒç”¨æµ‹è¯•');
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger2.trigger('åµŒå¥—è°ƒç”¨è§¦å‘å™¨');
        assert(true, 'åµŒå¥—è°ƒç”¨åœºæ™¯æµ‹è¯•ï¼ˆçŠ¶æ€æœºé˜²æº¢å‡ºï¼‰');

        // æµ‹è¯•åŠ¨æ€ç±»å‹
        const logger3 = createLogger({
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });
        const dynamicTypes = ['custom1', 'custom2', 'custom3'];
        dynamicTypes.forEach(logType => {
          logger3[logType](`åŠ¨æ€ç±»å‹ ${logType} æµ‹è¯•`);
        });
        assert(true, 'åŠ¨æ€ç±»å‹åœºæ™¯æµ‹è¯•');

        // æµ‹è¯•æ·±åº¦åµŒå¥—è°ƒç”¨é“¾
        const logger4 = createLogger({
          maxNestingDepth: 5,
          transform: ({ type, messages, isNestingCall }) => {
            if (type === 'chain' && !isNestingCall) {
              // åˆ›å»ºæ·±åº¦åµŒå¥—è°ƒç”¨é“¾
              logger4.chain1('é“¾å¼è°ƒç”¨1');
              logger4.chain2('é“¾å¼è°ƒç”¨2');
              logger4.chain3('é“¾å¼è°ƒç”¨3');
              logger4.chain4('é“¾å¼è°ƒç”¨4');
              logger4.chain5('é“¾å¼è°ƒç”¨5');
              logger4.chain6('é“¾å¼è°ƒç”¨6 - åº”è¯¥è¢«ä¸¢å¼ƒ');
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger4.chain('è§¦å‘é“¾å¼åµŒå¥—è°ƒç”¨');
        assert(true, 'æ·±åº¦åµŒå¥—è°ƒç”¨é“¾æµ‹è¯•');
      });
    }

    // 17. å†…å­˜ç®¡ç†æµ‹è¯•
    function testMemoryManagement() {
      console.clear();
      testSection('å†…å­˜ç®¡ç†æµ‹è¯•', () => {
        // æµ‹è¯•å‡½æ•°ç¼“å­˜
        const logger = createLogger({
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        // åˆ›å»ºå¤§é‡ä¸åŒç±»å‹çš„æ—¥å¿—å‡½æ•°
        const logTypes = [];
        for (let typeIndex = 0; typeIndex < 100; typeIndex++) {
          const logType = `type${typeIndex}`;
          logTypes.push(logType);
          logger[logType](`ç±»å‹ ${logType} æµ‹è¯•`);
        }

        // éªŒè¯å‡½æ•°è¢«ç¼“å­˜
        logTypes.forEach(logType => {
          const cachedFn1 = logger[logType];
          const cachedFn2 = logger[logType];
          assert(cachedFn1 === cachedFn2, `ç±»å‹ ${logType} å‡½æ•°è¢«æ­£ç¡®ç¼“å­˜`);
        });

        // æµ‹è¯•åµŒå¥—è°ƒç”¨åçš„çŠ¶æ€æ¸…ç†
        const logger2 = createLogger({
          transform: ({ type, messages, isNestingCall }) => {
            if (type === 'cleanup' && !isNestingCall) {
              logger2.nested1('åµŒå¥—1');
              logger2.nested2('åµŒå¥—2');
            }
            return { type, messages, isNestingCall };
          },
          outputAdapters: [webConsoleAdapter({ group: { enable: false } })]
        });

        logger2.cleanup('çŠ¶æ€æ¸…ç†æµ‹è¯•');
        // å†æ¬¡è°ƒç”¨ï¼ŒéªŒè¯çŠ¶æ€å·²æ¸…ç†
        logger2.info('çŠ¶æ€æ¸…ç†åçš„æ­£å¸¸è°ƒç”¨');
        assert(true, 'åµŒå¥—è°ƒç”¨åçŠ¶æ€æ¸…ç†æµ‹è¯•');

        assert(true, 'å†…å­˜ç®¡ç†æµ‹è¯•å®Œæˆ');
      });
    }

    // è¿è¡Œæ‰€æœ‰æµ‹è¯•
    function runAllTests() {
      console.clear();
      console.log('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...\n');

      // é‡ç½®æµ‹è¯•ç»“æœ
      testResults = { total: 0, passed: 0, failed: 0, errors: [] };

      // æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
      const tests = [
        testLoggerCore,
        testAdapterBasic,
        testGroupFeatures,
        testConsoleLevels,
        testMessageHandlers,
        testAllowTypes,
        testEnvironmentValidation,
        testColorFormats,
        testGradientStyles,
        testCustomStyles,
        testTransformReport,
        testEdgeCases,
        testNestingDepthControl,
        testPerformance,
        testCompatibility,
        testComplexScenarios,
        testMemoryManagement
      ];

      tests.forEach((test, index) => {
        console.log(`\nğŸ“‹ è¿è¡Œæµ‹è¯• ${index + 1}/${tests.length}: ${test.name}`);
        test();
      });

      console.clear();

      // è¾“å‡ºæµ‹è¯•æ€»ç»“
      console.log(`\n${'='.repeat(60)}`);
      console.log('ğŸ“Š æµ‹è¯•æ€»ç»“æŠ¥å‘Š');
      console.log('='.repeat(60));
      console.log(`æ€»æµ‹è¯•æ•°: ${testResults.total}`);
      console.log(`âœ… é€šè¿‡: ${testResults.passed}`);
      console.log(`âŒ å¤±è´¥: ${testResults.failed}`);
      console.log(`æˆåŠŸç‡: ${((testResults.passed / testResults.total) * 100).toFixed(2)}%`);

      if (testResults.errors.length > 0) {
        console.log('\nâŒ å¤±è´¥çš„æµ‹è¯•:');
        testResults.errors.forEach((error, index) => {
          console.log(`${index + 1}. ${error}`);
        });
      }

      console.log('\nğŸ‰ æµ‹è¯•å¥—ä»¶è¿è¡Œå®Œæˆ!');
    }

    // å°†æ‰€æœ‰æµ‹è¯•å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
    window.testLoggerCore = testLoggerCore;
    window.testAdapterBasic = testAdapterBasic;
    window.testGroupFeatures = testGroupFeatures;
    window.testConsoleLevels = testConsoleLevels;
    window.testMessageHandlers = testMessageHandlers;
    window.testAllowTypes = testAllowTypes;
    window.testEnvironmentValidation = testEnvironmentValidation;
    window.testColorFormats = testColorFormats;
    window.testGradientStyles = testGradientStyles;
    window.testCustomStyles = testCustomStyles;
    window.testTransformReport = testTransformReport;
    window.testEdgeCases = testEdgeCases;
    window.testNestingDepthControl = testNestingDepthControl;
    window.testPerformance = testPerformance;
    window.testCompatibility = testCompatibility;
    window.testComplexScenarios = testComplexScenarios;
    window.testMemoryManagement = testMemoryManagement;
    window.runAllTests = runAllTests;

    console.log('ğŸ§ª Logger å®Œæ•´åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
    console.log('ğŸ’¡ å»ºè®®ç‚¹å‡» "è¿è¡Œæ‰€æœ‰æµ‹è¯•" æŒ‰é’®è·å¾—å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š');
  </script>
</body>

</html>